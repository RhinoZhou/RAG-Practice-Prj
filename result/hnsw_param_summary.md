
# HNSW 参数敏感性实验报告

## 实验概述
本实验对FAISS库中的HNSW索引进行了参数敏感性分析，遍历了不同的M、efConstruction和efSearch参数组合，
测量并记录了各参数组合下的检索性能（召回率和查询延迟），以辅助直观展示"参数换精度/延迟"的权衡关系。

## 实验配置
- **向量维度**: 256
- **训练向量数量**: 1800
- **查询向量数量**: 100
- **检索Top-K**: 10
- **参数范围**:
  - M ∈ [16, 32]
  - efConstruction ∈ [100, 200]
  - efSearch ∈ [64, 128, 256]

## 最佳参数组合
根据F1分数（平衡速度和精度），最佳参数组合如下：
- **M**: 16
- **efConstruction**: 100
- **efSearch**: 128
- **平均查询时间**: 0.027 ms
- **Recall@10**: 0.985
- **F1分数**: 0.792

## 性能指标表格

| M  | efConstruction | efSearch | 平均查询时间(ms) | Recall@10 |
|----|----------------|----------|-----------------|------------|
| 32.0  | 200.0 | 256.0 | 0.050 | 1.000 |
| 32.0  | 100.0 | 256.0 | 0.051 | 1.000 |
| 16.0  | 200.0 | 256.0 | 0.043 | 0.999 |
| 16.0  | 100.0 | 256.0 | 0.055 | 0.999 |
| 32.0  | 100.0 | 128.0 | 0.062 | 0.998 |
| 32.0  | 200.0 | 128.0 | 0.072 | 0.998 |
| 16.0  | 200.0 | 128.0 | 0.057 | 0.989 |
| 16.0  | 100.0 | 128.0 | 0.027 | 0.985 |
| 32.0  | 200.0 | 64.0 | 0.065 | 0.978 |
| 32.0  | 100.0 | 64.0 | 0.036 | 0.975 |
| 16.0  | 200.0 | 64.0 | 0.025 | 0.930 |
| 16.0  | 100.0 | 64.0 | 0.014 | 0.925 |


## 实验结果分析

### 参数影响分析

#### M参数影响
M参数控制HNSW图中每个节点的最大连接数：
- **较大的M值**：通常可以获得更高的召回率，但会增加索引大小和构建时间
- **较小的M值**：索引更小，构建更快，但召回率可能较低

#### efConstruction参数影响
efConstruction参数控制构建索引时的搜索范围：
- **较大的efConstruction值**：可以获得更高质量的索引结构，提升查询性能，但会增加构建时间
- **较小的efConstruction值**：构建更快，但索引质量可能较低

#### efSearch参数影响
efSearch参数控制查询时的搜索范围：
- **较大的efSearch值**：可以获得更高的召回率，但会增加查询延迟
- **较小的efSearch值**：查询更快，但召回率可能较低

### 延迟-召回权衡分析

通过实验结果可以观察到明显的延迟-召回权衡关系：
1. **高召回率配置**：当efSearch增加时，Recall@10提高，但查询延迟也随之增加
2. **低延迟配置**：当efSearch减少时，查询速度加快，但Recall@10会降低
3. **平衡配置**：最佳参数组合在速度和精度之间取得了较好的平衡

### 图表可视化（占位）

以下是延迟-召回权衡关系的可视化图表（实际使用时需根据CSV数据生成）：

![延迟-召回曲线](延迟-召回曲线.png)

## 结论

本实验成功演示了HNSW索引参数对检索性能的影响，验证了"参数换精度/延迟"的权衡关系。
在实际应用中，可以根据具体需求（是优先考虑速度还是精度）选择合适的参数组合。

如果应用场景对延迟敏感，可以选择较小的efSearch值；
如果应用场景对召回率要求较高，可以选择较大的efSearch值；
如果需要平衡速度和精度，可以参考本次实验找出的最佳参数组合。
