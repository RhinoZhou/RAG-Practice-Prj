# BM25与向量检索融合策略对比实验报告

作者: Ph.D. Rhino


## 实验概述

本实验对比了BM25检索、向量检索以及两种不同融合策略（RRF和加权融合）的检索效果。
实验使用了30条短文档组成的小型语料库，并针对10个查询进行了检索测试。


## 实验配置

- 语料库大小: 30条短文档
- 查询数量: 10个查询
- BM25模型: rank_bm25库中的BM25Okapi
- 向量模型: TF-IDF (scikit-learn)
- 融合策略:
  - RRF (Reciprocal Rank Fusion)，k=60, weight=1.0
  - 加权融合，alpha=0.5


## 检索结果对比

### 查询 1: 向量数据库是什么


| 排名 | BM25检索 | 向量检索 | RRF融合 | 加权融合(α=0.5) |
|------|---------|---------|---------|----------------|
| 1 | 1 | 1 | 1 | 10 |
| 2 | 2 | 2 | 2 | 9 |
| 3 | 3 | 3 | 3 | 8 |
| 4 | 4 | 4 | 4 | 7 |
| 5 | 5 | 5 | 5 | 6 |
| 6 | 6 | 6 | 6 | 5 |
| 7 | 7 | 7 | 7 | 4 |
| 8 | 8 | 8 | 8 | 3 |
| 9 | 9 | 9 | 9 | 2 |
| 10 | 10 | 10 | 10 | 1 |


**文档内容说明:**
- 排名 1 的文档: 选择嵌入模型时需要考虑模型的性能、效率、适用场景和与下游任务的兼容性等因素。
- 排名 2 的文档: 如何选择合适的嵌入模型？
- 排名 3 的文档: RRF是一种简单而有效的检索结果融合方法，通过计算文档在多个检索结果中的倒数排名之和来确定最终排名。
- 排名 4 的文档: BM25算法中的参数（如k1、b）用于调整词频饱和和文档长度归一化的程度，影响检索结果的质量。
- 排名 5 的文档: 什么是检索融合？
- 排名 6 的文档: 检索融合是将多种检索方法的结果合并的技术，常用的方法包括RRF（Reciprocal Rank Fusion）和加权融合等。
- 排名 7 的文档: 向量索引的构建通常包括数据预处理、特征提取、索引创建和参数优化等步骤。
- 排名 8 的文档: 向量索引的构建过程包括哪些步骤？
- 排名 9 的文档: BM25算法中的参数有什么作用？
- 排名 10 的文档: 什么是RRF（Reciprocal Rank Fusion）？

### 查询 2: FAISS的功能


| 排名 | BM25检索 | 向量检索 | RRF融合 | 加权融合(α=0.5) |
|------|---------|---------|---------|----------------|
| 1 | 1 | 1 | 1 | 10 |
| 2 | 2 | 2 | 2 | 9 |
| 3 | 3 | 3 | 3 | 8 |
| 4 | 4 | 4 | 4 | 7 |
| 5 | 5 | 5 | 5 | 6 |
| 6 | 6 | 6 | 6 | 5 |
| 7 | 7 | 7 | 7 | 4 |
| 8 | 8 | 8 | 8 | 3 |
| 9 | 9 | 9 | 9 | 2 |
| 10 | 10 | 10 | 10 | 1 |


**文档内容说明:**
- 排名 1 的文档: 选择嵌入模型时需要考虑模型的性能、效率、适用场景和与下游任务的兼容性等因素。
- 排名 2 的文档: 如何选择合适的嵌入模型？
- 排名 3 的文档: RRF是一种简单而有效的检索结果融合方法，通过计算文档在多个检索结果中的倒数排名之和来确定最终排名。
- 排名 4 的文档: BM25算法中的参数（如k1、b）用于调整词频饱和和文档长度归一化的程度，影响检索结果的质量。
- 排名 5 的文档: 什么是检索融合？
- 排名 6 的文档: 检索融合是将多种检索方法的结果合并的技术，常用的方法包括RRF（Reciprocal Rank Fusion）和加权融合等。
- 排名 7 的文档: 向量索引的构建通常包括数据预处理、特征提取、索引创建和参数优化等步骤。
- 排名 8 的文档: 向量索引的构建过程包括哪些步骤？
- 排名 9 的文档: BM25算法中的参数有什么作用？
- 排名 10 的文档: 什么是RRF（Reciprocal Rank Fusion）？

### 查询 3: HNSW和IVF-PQ的区别


| 排名 | BM25检索 | 向量检索 | RRF融合 | 加权融合(α=0.5) |
|------|---------|---------|---------|----------------|
| 1 | 1 | 1 | 1 | 10 |
| 2 | 2 | 2 | 2 | 9 |
| 3 | 3 | 3 | 3 | 8 |
| 4 | 4 | 4 | 4 | 7 |
| 5 | 5 | 5 | 5 | 6 |
| 6 | 6 | 6 | 6 | 5 |
| 7 | 7 | 7 | 7 | 4 |
| 8 | 8 | 8 | 8 | 3 |
| 9 | 9 | 9 | 9 | 2 |
| 10 | 10 | 10 | 10 | 1 |


**文档内容说明:**
- 排名 1 的文档: 选择嵌入模型时需要考虑模型的性能、效率、适用场景和与下游任务的兼容性等因素。
- 排名 2 的文档: 如何选择合适的嵌入模型？
- 排名 3 的文档: RRF是一种简单而有效的检索结果融合方法，通过计算文档在多个检索结果中的倒数排名之和来确定最终排名。
- 排名 4 的文档: BM25算法中的参数（如k1、b）用于调整词频饱和和文档长度归一化的程度，影响检索结果的质量。
- 排名 5 的文档: 什么是检索融合？
- 排名 6 的文档: 检索融合是将多种检索方法的结果合并的技术，常用的方法包括RRF（Reciprocal Rank Fusion）和加权融合等。
- 排名 7 的文档: 向量索引的构建通常包括数据预处理、特征提取、索引创建和参数优化等步骤。
- 排名 8 的文档: 向量索引的构建过程包括哪些步骤？
- 排名 9 的文档: BM25算法中的参数有什么作用？
- 排名 10 的文档: 什么是RRF（Reciprocal Rank Fusion）？

### 查询 4: 如何评估检索性能


| 排名 | BM25检索 | 向量检索 | RRF融合 | 加权融合(α=0.5) |
|------|---------|---------|---------|----------------|
| 1 | 1 | 1 | 1 | 10 |
| 2 | 2 | 2 | 2 | 9 |
| 3 | 3 | 3 | 3 | 8 |
| 4 | 4 | 4 | 4 | 7 |
| 5 | 5 | 5 | 5 | 6 |
| 6 | 6 | 6 | 6 | 5 |
| 7 | 7 | 7 | 7 | 4 |
| 8 | 8 | 8 | 8 | 3 |
| 9 | 9 | 9 | 9 | 2 |
| 10 | 10 | 10 | 10 | 1 |


**文档内容说明:**
- 排名 1 的文档: 选择嵌入模型时需要考虑模型的性能、效率、适用场景和与下游任务的兼容性等因素。
- 排名 2 的文档: 如何选择合适的嵌入模型？
- 排名 3 的文档: RRF是一种简单而有效的检索结果融合方法，通过计算文档在多个检索结果中的倒数排名之和来确定最终排名。
- 排名 4 的文档: BM25算法中的参数（如k1、b）用于调整词频饱和和文档长度归一化的程度，影响检索结果的质量。
- 排名 5 的文档: 什么是检索融合？
- 排名 6 的文档: 检索融合是将多种检索方法的结果合并的技术，常用的方法包括RRF（Reciprocal Rank Fusion）和加权融合等。
- 排名 7 的文档: 向量索引的构建通常包括数据预处理、特征提取、索引创建和参数优化等步骤。
- 排名 8 的文档: 向量索引的构建过程包括哪些步骤？
- 排名 9 的文档: BM25算法中的参数有什么作用？
- 排名 10 的文档: 什么是RRF（Reciprocal Rank Fusion）？

### 查询 5: 什么是语义搜索


| 排名 | BM25检索 | 向量检索 | RRF融合 | 加权融合(α=0.5) |
|------|---------|---------|---------|----------------|
| 1 | 1 | 2 | 1 | 11 |
| 2 | 2 | 4 | 2 | 10 |
| 3 | 3 | 3 | 3 | 9 |
| 4 | 5 | 5 | 4 | 7 |
| 5 | 6 | 6 | 5 | 6 |
| 6 | 7 | 7 | 6 | 5 |
| 7 | 8 | 8 | 7 | 4 |
| 8 | 9 | 9 | 8 | 3 |
| 9 | 10 | 10 | 9 | 2 |
| 10 | - | 1 | 10 | 1 |


**文档内容说明:**
- 排名 1 的文档: BM25算法中的参数（如k1、b）用于调整词频饱和和文档长度归一化的程度，影响检索结果的质量。
- 排名 2 的文档: 什么是检索融合？
- 排名 3 的文档: 检索融合是将多种检索方法的结果合并的技术，常用的方法包括RRF（Reciprocal Rank Fusion）和加权融合等。
- 排名 4 的文档: 向量索引的构建过程包括哪些步骤？
- 排名 5 的文档: 如何选择合适的嵌入模型？
- 排名 6 的文档: 什么是RRF（Reciprocal Rank Fusion）？
- 排名 7 的文档: 什么是语义搜索？
- 排名 8 的文档: 向量索引的构建通常包括数据预处理、特征提取、索引创建和参数优化等步骤。
- 排名 9 的文档: 选择嵌入模型时需要考虑模型的性能、效率、适用场景和与下游任务的兼容性等因素。
- 排名 10 的文档: RRF是一种简单而有效的检索结果融合方法，通过计算文档在多个检索结果中的倒数排名之和来确定最终排名。

### 查询 6: BM25算法原理


| 排名 | BM25检索 | 向量检索 | RRF融合 | 加权融合(α=0.5) |
|------|---------|---------|---------|----------------|
| 1 | 1 | 1 | 1 | 10 |
| 2 | 2 | 2 | 2 | 9 |
| 3 | 3 | 3 | 3 | 8 |
| 4 | 4 | 4 | 4 | 7 |
| 5 | 5 | 5 | 5 | 6 |
| 6 | 6 | 6 | 6 | 5 |
| 7 | 7 | 7 | 7 | 4 |
| 8 | 8 | 8 | 8 | 3 |
| 9 | 9 | 9 | 9 | 2 |
| 10 | 10 | 10 | 10 | 1 |


**文档内容说明:**
- 排名 1 的文档: 选择嵌入模型时需要考虑模型的性能、效率、适用场景和与下游任务的兼容性等因素。
- 排名 2 的文档: 如何选择合适的嵌入模型？
- 排名 3 的文档: RRF是一种简单而有效的检索结果融合方法，通过计算文档在多个检索结果中的倒数排名之和来确定最终排名。
- 排名 4 的文档: BM25算法中的参数（如k1、b）用于调整词频饱和和文档长度归一化的程度，影响检索结果的质量。
- 排名 5 的文档: 什么是检索融合？
- 排名 6 的文档: 检索融合是将多种检索方法的结果合并的技术，常用的方法包括RRF（Reciprocal Rank Fusion）和加权融合等。
- 排名 7 的文档: 向量索引的构建通常包括数据预处理、特征提取、索引创建和参数优化等步骤。
- 排名 8 的文档: 向量索引的构建过程包括哪些步骤？
- 排名 9 的文档: BM25算法中的参数有什么作用？
- 排名 10 的文档: 什么是RRF（Reciprocal Rank Fusion）？

### 查询 7: RAG技术的应用


| 排名 | BM25检索 | 向量检索 | RRF融合 | 加权融合(α=0.5) |
|------|---------|---------|---------|----------------|
| 1 | 1 | 1 | 1 | 10 |
| 2 | 2 | 2 | 2 | 9 |
| 3 | 3 | 3 | 3 | 8 |
| 4 | 4 | 4 | 4 | 7 |
| 5 | 5 | 5 | 5 | 6 |
| 6 | 6 | 6 | 6 | 5 |
| 7 | 7 | 7 | 7 | 4 |
| 8 | 8 | 8 | 8 | 3 |
| 9 | 9 | 9 | 9 | 2 |
| 10 | 10 | 10 | 10 | 1 |


**文档内容说明:**
- 排名 1 的文档: 选择嵌入模型时需要考虑模型的性能、效率、适用场景和与下游任务的兼容性等因素。
- 排名 2 的文档: 如何选择合适的嵌入模型？
- 排名 3 的文档: RRF是一种简单而有效的检索结果融合方法，通过计算文档在多个检索结果中的倒数排名之和来确定最终排名。
- 排名 4 的文档: BM25算法中的参数（如k1、b）用于调整词频饱和和文档长度归一化的程度，影响检索结果的质量。
- 排名 5 的文档: 什么是检索融合？
- 排名 6 的文档: 检索融合是将多种检索方法的结果合并的技术，常用的方法包括RRF（Reciprocal Rank Fusion）和加权融合等。
- 排名 7 的文档: 向量索引的构建通常包括数据预处理、特征提取、索引创建和参数优化等步骤。
- 排名 8 的文档: 向量索引的构建过程包括哪些步骤？
- 排名 9 的文档: BM25算法中的参数有什么作用？
- 排名 10 的文档: 什么是RRF（Reciprocal Rank Fusion）？

### 查询 8: 向量嵌入的作用


| 排名 | BM25检索 | 向量检索 | RRF融合 | 加权融合(α=0.5) |
|------|---------|---------|---------|----------------|
| 1 | 1 | 1 | 1 | 10 |
| 2 | 2 | 2 | 2 | 9 |
| 3 | 3 | 3 | 3 | 8 |
| 4 | 4 | 4 | 4 | 7 |
| 5 | 5 | 5 | 5 | 6 |
| 6 | 6 | 6 | 6 | 5 |
| 7 | 7 | 7 | 7 | 4 |
| 8 | 8 | 8 | 8 | 3 |
| 9 | 9 | 9 | 9 | 2 |
| 10 | 10 | 10 | 10 | 1 |


**文档内容说明:**
- 排名 1 的文档: 选择嵌入模型时需要考虑模型的性能、效率、适用场景和与下游任务的兼容性等因素。
- 排名 2 的文档: 如何选择合适的嵌入模型？
- 排名 3 的文档: RRF是一种简单而有效的检索结果融合方法，通过计算文档在多个检索结果中的倒数排名之和来确定最终排名。
- 排名 4 的文档: BM25算法中的参数（如k1、b）用于调整词频饱和和文档长度归一化的程度，影响检索结果的质量。
- 排名 5 的文档: 什么是检索融合？
- 排名 6 的文档: 检索融合是将多种检索方法的结果合并的技术，常用的方法包括RRF（Reciprocal Rank Fusion）和加权融合等。
- 排名 7 的文档: 向量索引的构建通常包括数据预处理、特征提取、索引创建和参数优化等步骤。
- 排名 8 的文档: 向量索引的构建过程包括哪些步骤？
- 排名 9 的文档: BM25算法中的参数有什么作用？
- 排名 10 的文档: 什么是RRF（Reciprocal Rank Fusion）？

### 查询 9: 混合检索方法


| 排名 | BM25检索 | 向量检索 | RRF融合 | 加权融合(α=0.5) |
|------|---------|---------|---------|----------------|
| 1 | 1 | 1 | 1 | 10 |
| 2 | 2 | 2 | 2 | 9 |
| 3 | 3 | 3 | 3 | 8 |
| 4 | 4 | 4 | 4 | 7 |
| 5 | 5 | 5 | 5 | 6 |
| 6 | 6 | 6 | 6 | 5 |
| 7 | 7 | 7 | 7 | 4 |
| 8 | 8 | 8 | 8 | 3 |
| 9 | 9 | 9 | 9 | 2 |
| 10 | 10 | 10 | 10 | 1 |


**文档内容说明:**
- 排名 1 的文档: 选择嵌入模型时需要考虑模型的性能、效率、适用场景和与下游任务的兼容性等因素。
- 排名 2 的文档: 如何选择合适的嵌入模型？
- 排名 3 的文档: RRF是一种简单而有效的检索结果融合方法，通过计算文档在多个检索结果中的倒数排名之和来确定最终排名。
- 排名 4 的文档: BM25算法中的参数（如k1、b）用于调整词频饱和和文档长度归一化的程度，影响检索结果的质量。
- 排名 5 的文档: 什么是检索融合？
- 排名 6 的文档: 检索融合是将多种检索方法的结果合并的技术，常用的方法包括RRF（Reciprocal Rank Fusion）和加权融合等。
- 排名 7 的文档: 向量索引的构建通常包括数据预处理、特征提取、索引创建和参数优化等步骤。
- 排名 8 的文档: 向量索引的构建过程包括哪些步骤？
- 排名 9 的文档: BM25算法中的参数有什么作用？
- 排名 10 的文档: 什么是RRF（Reciprocal Rank Fusion）？

### 查询 10: 检索结果融合技术


| 排名 | BM25检索 | 向量检索 | RRF融合 | 加权融合(α=0.5) |
|------|---------|---------|---------|----------------|
| 1 | 1 | 1 | 1 | 10 |
| 2 | 2 | 2 | 2 | 9 |
| 3 | 3 | 3 | 3 | 8 |
| 4 | 4 | 4 | 4 | 7 |
| 5 | 5 | 5 | 5 | 6 |
| 6 | 6 | 6 | 6 | 5 |
| 7 | 7 | 7 | 7 | 4 |
| 8 | 8 | 8 | 8 | 3 |
| 9 | 9 | 9 | 9 | 2 |
| 10 | 10 | 10 | 10 | 1 |


**文档内容说明:**
- 排名 1 的文档: 选择嵌入模型时需要考虑模型的性能、效率、适用场景和与下游任务的兼容性等因素。
- 排名 2 的文档: 如何选择合适的嵌入模型？
- 排名 3 的文档: RRF是一种简单而有效的检索结果融合方法，通过计算文档在多个检索结果中的倒数排名之和来确定最终排名。
- 排名 4 的文档: BM25算法中的参数（如k1、b）用于调整词频饱和和文档长度归一化的程度，影响检索结果的质量。
- 排名 5 的文档: 什么是检索融合？
- 排名 6 的文档: 检索融合是将多种检索方法的结果合并的技术，常用的方法包括RRF（Reciprocal Rank Fusion）和加权融合等。
- 排名 7 的文档: 向量索引的构建通常包括数据预处理、特征提取、索引创建和参数优化等步骤。
- 排名 8 的文档: 向量索引的构建过程包括哪些步骤？
- 排名 9 的文档: BM25算法中的参数有什么作用？
- 排名 10 的文档: 什么是RRF（Reciprocal Rank Fusion）？


## 实验结果分析

### 不同检索策略的特点

1. **BM25检索**: 基于关键词匹配，对于包含查询中明确关键词的文档有较好的表现，但可能无法理解语义相关性。

2. **向量检索**: 基于TF-IDF的向量表示，能够捕获词频和逆文档频率信息，但不考虑词序和语义关系。

3. **RRF融合**: 通过结合多个检索结果的排名信息，能够综合利用不同检索策略的优势，通常比单一策略表现更好。

4. **加权融合**: 通过直接加权组合不同检索策略的得分，参数α可以根据具体任务进行调整。

### 融合策略的可调参数

#### RRF融合的可调参数

- **k**: 控制排名的影响力，较小的k值会给排名靠前的文档更大的权重。通常取值在50-100之间。

- **weight**: 向量检索结果的权重，可以调整不同检索策略的相对重要性。

#### 加权融合的可调参数

- **α**: 控制向量检索结果的权重，范围在0到1之间：
  - α=0: 完全使用BM25检索结果
  - α=1: 完全使用向量检索结果
  - 0<α<1: 混合使用两种检索结果

### 最佳实践建议

1. **参数调优**: 根据具体的应用场景和数据特点，调整RRF的k值和weight参数，或加权融合的α参数。

2. **组合多种检索策略**: 除了BM25和TF-IDF向量检索外，还可以考虑结合其他检索方法，如深度学习模型等。

3. **考虑文档长度**: 在实际应用中，可能需要对不同长度的文档进行适当的归一化处理。

4. **定期评估和更新**: 随着语料库的更新和应用场景的变化，定期评估和调整融合策略。

## 结论

本实验表明，融合多种检索策略（如BM25和向量检索）通常能够获得比单一策略更好的检索效果。
RRF和加权融合是两种有效的融合方法，它们各有优缺点和可调参数，可以根据具体需求进行选择和调整。

注意：本实验使用TF-IDF作为向量表示方法以避免依赖问题。在实际应用中，可以考虑使用更高级的语义嵌入模型（如SentenceTransformer）来获得更好的语义理解能力。