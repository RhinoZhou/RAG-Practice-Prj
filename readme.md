# RAG系统增强索引实践工具集

## 目录结构

### 子目录说明
- **reports/**: 存放各类报告文件，包括AB测试报告、网格配置结果和指标CSV数据
- **result/**: 存放中间结果文件，包括锚点映射和层次节点信息


### 01-sliding_window_parameters.py
**滑动窗口参数优化工具**
- 功能：优化滑动窗口大小、步长等参数配置
- 执行流程：测试不同窗口参数组合，生成性能报告
- 输出：滑动窗口参数CSV文件、报告文本和可视化图表

### 02-hier_index_with_anchors.py
**层次索引与锚点构建工具**
- 功能：构建带有锚点的层次化索引结构
- 执行流程：创建索引层次，添加锚点映射，优化检索路径

### 03-triple_keys_check_and_fallback.py
**三重键值检查与回退机制**
- 功能：实现三重键值验证与故障回退策略
- 执行流程：验证键值有效性，触发回退机制，生成验证报告

### 04-two_stage_summary_details.py
**两阶段摘要与细节检索**
- 功能：先摘要检索再细节检索的两阶段检索策略
- 执行流程：摘要检索初筛，细节检索精排，输出多阶段结果

### 05-consistency_gate_and_fallback.py
**一致性阈值守门与回退**
- 功能：计算摘要与细节一致性，低于阈值回退到全文重排
- 执行流程：计算"摘要句 ↔ 细节段"一致性均分，低于阈值触发回退
- 使用场景：RAG系统中的检索质量保障，防止因摘要误匹配导致的细节检索偏差

### 06-extractive_summary_with_citations.py
**抽取式摘要与引用生成工具**
- 功能：生成带有引用信息的抽取式摘要
- 执行流程：提取关键句，添加引用标记，生成结构化摘要

### 07-ab_eval_metrics_print.py
**AB测试指标打印工具**
- 功能：计算并打印AB测试的各项评估指标
- 执行流程：加载测试数据，计算对比指标，生成评估报告

### 08-leak_diagnose_reverse_search.py
**泄漏诊断与反向搜索工具**
- 功能：检测检索系统中的信息泄漏问题
- 执行流程：执行反向搜索，分析检索结果，诊断潜在泄漏

### 09-hybrid_rrf_demo.py
**混合检索RRF融合演示**
- 功能：演示多模态检索结果的RRF（Reciprocal Rank Fusion）融合方法
- 执行流程：获取多种检索结果，应用RRF融合，输出融合排序

### 10-mmr_dedup_and_concat.py
**MMR去冗与上下文选择工具**
- 功能：以MMR平衡相关性与多样性，选择top-k并估算冗余率
- 执行流程：构造候选词袋向量与相关分，迭代MMR选择，应用相似度阈值过滤冗余
- 输出：选中的片段列表、冗余率、拼接顺序

### 11-query_expansion_and_gate.py
**查询扩展与门控机制**
- 功能：实现查询扩展并通过门控机制过滤无效扩展
- 执行流程：扩展查询词，应用门控过滤，重新执行检索

### 12-intent_routing_and_scope.py
**意图路由与检索范围控制**
- 功能：基于查询意图路由到不同的检索范围
- 执行流程：识别用户意图，动态调整检索范围，优化检索结果

### 13-metadata_filter_field_weight.py
**元数据过滤与字段权重调整**
- 功能：实现元数据过滤和字段权重动态调整
- 执行流程：应用元数据过滤器，调整字段权重，重新排序结果

### 14-light_rerank_with_behavior.py
**轻量级重排序与行为数据集成**
- 功能：结合用户行为数据进行轻量级重排序
- 执行流程：收集行为信号，计算重排分数，优化最终排序

### 15-late_interaction_sim.py
**多向量晚交互匹配工具**
- 功能：以"查询词对文档词最大匹配"近似晚交互聚合打分
- 执行流程：构造查询/文档词向量，逐词计算最大匹配贡献，聚合得到晚交互得分
- 特点：展示细粒度对齐的优势

### 16-multimodal_index_merge.py
**多模态索引合并工具**
- 功能：合并不同模态的索引数据
- 执行流程：加载多模态数据，融合索引，支持跨模态检索

### 17-chain_of_density_heuristic.py
**密度链启发式工具**
- 功能：应用密度链启发式方法优化摘要生成
- 执行流程：迭代增加信息密度，生成层次化摘要

### 18-term_mapping_loader.py
**术语映射加载工具**
- 功能：加载和管理术语映射表
- 执行流程：读取术语映射数据，构建映射关系，支持检索增强

### 19-grid_config_and_report.py
**网格配置与报告生成器**
- 功能：执行网格搜索配置优化并生成报告
- 执行流程：测试不同参数组合，评估性能指标，生成综合报告

### 20-metrics_calculator.py
**检索指标计算器**
- 功能：计算P@k、R@k、MRR、nDCG@k的通用函数
- 内容概述：输入ranked列表与gold集，输出四类指标；支持二元相关与可配置k
- 执行流程：定义四项指标函数，准备ranked与gold示例，计算并打印各指标
- 调用说明：内置ranked/gold示例，无需外部输入，直接运行即可看到指标计算结果

### 21-canary_release_and_rollback.py
**灰度放量与回滚脚本**
- 功能：按放量计划监控阈值，越界触发自动回滚
- 内容概述：设定放量阶段（10%→100%）与阈值（回退率、p95）；每阶段模拟在线指标，若越界输出"回滚指令"
- 执行流程：定义放量计划与阈值，逐阶段采样在线指标，判定是否越界与动作，输出继续/回滚决策
- 调用说明：内置计划与阈值，无需外部输入，直接运行即可看到灰度放量模拟过程

### 22-diagnostic_recommender.py
**指标驱动诊断建议器**
- 功能：基于近期指标生成巡检与优化建议清单
- 内容概述：输入近期P@k、nDCG、Hit@1、冗余率、p95，按阈值规则判断"漏检/排序/冗余/延迟"问题，并输出对应SOP行动项
- 执行流程：读取指标快照，规则匹配定位问题，生成建议动作列表，打印分类与建议
- 调用说明：内置一组指标样例，无需外部输入，直接运行即可看到诊断结果和优化建议

## 其他相关内容

### 结果文件
目录中包含大量JSON格式的结果文件，命名规则通常为`[脚本名]_results_[序号].json`，记录了各工具执行后的详细结果数据。

### 报告文件
- **ab_eval_comparison.md**: AB测试对比报告
- **sliding_window_report.txt**: 滑动窗口参数优化报告
- **triple_keys_validation_report.txt**: 三重键值验证报告

### 数据文件
- **sliding_window_parameters.csv**: 滑动窗口参数数据
- **reports/metrics.csv**: 各项评估指标的汇总数据

## 使用方法

1. 确保已安装Python 3.6+及必要的依赖包
2. 每个Python脚本可以独立运行，直接执行`python [脚本名].py`即可
3. 大部分脚本内置了示例数据，无需额外输入
4. 执行结果将输出到控制台，并保存为JSON格式的结果文件

